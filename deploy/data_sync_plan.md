# 数据库迁移和同步方案

## 1. 初始数据迁移

### 1.1 准备工作
- 确保数据库服务器已部署并运行
- 在数据库服务器上创建feishu_task_db数据库
- 创建feishu_user用户并授予相应权限

### 1.2 执行迁移脚本
- 使用之前创建的migrate_to_mysql.py脚本将本地SQLite数据迁移至远程MySQL数据库
- 确保迁移过程中网络连接稳定

### 1.3 验证数据完整性
- 检查tasks表和feishu_records表的数据是否完整迁移
- 验证关键字段是否正确导入

## 2. 持续数据同步

### 2.1 应用层同步
- 应用程序直接连接远程MySQL数据库进行读写操作
- 通过SQLAlchemy ORM确保数据一致性

### 2.2 定时任务同步
- 使用schedule库定时从飞书API获取最新数据
- 将新数据直接写入远程MySQL数据库

## 3. 故障恢复和备份

### 3.1 定时备份
- 在数据库服务器上设置定时任务，定期备份数据库
- 备份文件存储在单独的存储设备或云存储中

### 3.2 恢复流程
- 在发生故障时，从最近的备份恢复数据库
- 验证恢复后的数据完整性

## 4. 监控和告警

### 4.1 数据库监控
- 监控数据库连接数、查询性能等指标
- 设置慢查询日志分析

### 4.2 应用监控
- 监控应用与数据库的连接状态
- 记录数据访问错误和异常

## 5. 安全措施

### 5.1 数据传输安全
- 使用SSL加密数据库连接（可选）
- 限制数据库用户权限，仅授予必要的操作权限

### 5.2 访问控制
- 通过防火墙规则限制对数据库端口的访问
- 仅允许计算服务器IP访问数据库端口